# Definition of Done: Phase 4 CLI Commands

**Topic**: CLI Commands (User Interface)
**Created**: 2024-12-18

## Acceptance Criteria

### Root Command and Global Setup

- [ ] Root command shows help with all subcommands listed
- [ ] `--repo` flag finds git repository from specified path
- [ ] `--json` flag switches all output to JSON format
- [ ] `--quiet` flag suppresses non-essential output
- [ ] `--version` shows version information
- [ ] Error messages display hints when available
- [ ] Exit codes match spec (0-5)

### List Command (`yagwt ls`)

- [ ] `yagwt ls` lists all workspaces
- [ ] `yagwt ls --json` outputs JSON with schemaVersion
- [ ] `yagwt ls --filter "flag:pinned"` filters workspaces
- [ ] Empty list shows appropriate message (not error)
- [ ] Human output shows formatted table

### Show Command (`yagwt show`)

- [ ] `yagwt show <selector>` displays workspace details
- [ ] `yagwt show name:foo` works with typed selector
- [ ] Returns exit code 5 for not found
- [ ] Returns exit code 2 for ambiguous selector

### Path Command (`yagwt path`)

- [ ] `yagwt path <selector>` prints just the path
- [ ] Output is suitable for scripting: `cd $(yagwt path foo)`

### New Command (`yagwt new`)

- [ ] `yagwt new feature-x` creates workspace for branch
- [ ] `--name` flag sets custom name
- [ ] `--dir` flag sets custom directory
- [ ] `--ephemeral --ttl 7d` creates ephemeral workspace
- [ ] `--pin` creates pinned workspace
- [ ] Prints created workspace info

### Remove Command (`yagwt rm`)

- [ ] `yagwt rm <selector>` removes workspace
- [ ] `--force` removes even if dirty
- [ ] `--on-dirty=stash` stashes before removal
- [ ] `--on-dirty=patch` creates patch before removal
- [ ] Refuses to remove pinned workspace (hints to unpin)
- [ ] Interactive prompt when dirty (unless --no-prompt)

### Modify Commands

- [ ] `yagwt rename <selector> <new-name>` renames workspace
- [ ] `yagwt pin <selector>` pins workspace
- [ ] `yagwt unpin <selector>` unpins workspace
- [ ] `yagwt lock <selector>` locks workspace
- [ ] `yagwt unlock <selector>` unlocks workspace

### Clean Command (`yagwt clean`)

- [ ] `yagwt clean` shows cleanup plan (dry-run by default)
- [ ] `yagwt clean --apply` executes cleanup
- [ ] `--policy aggressive` uses aggressive policy
- [ ] `--max 5` limits removals

### Doctor Command (`yagwt doctor`)

- [ ] `yagwt doctor` shows issues (dry-run by default)
- [ ] `yagwt doctor --forget-missing` repairs orphaned metadata
- [ ] Shows broken workspaces and repairs

### Version Command

- [ ] `yagwt version` shows version info
- [ ] `yagwt version --json` outputs JSON version info

### Output Formatting

- [ ] Human output is readable with aligned columns
- [ ] JSON output includes schemaVersion: 1
- [ ] Error output includes error code and hints

### Overall Quality

- [ ] All commands work with real git repos
- [ ] `--help` shows usage for each command
- [ ] Exit codes match documentation
- [ ] Build compiles without warnings

## Sprint Scope

**Deliverables**:
1. Complete Cobra command structure with all subcommands
2. All read commands (ls, show, path, resolve)
3. Create/modify/remove commands (new, rm, rename, pin, lock)
4. Maintenance commands (clean, doctor)
5. Output formatting (human, JSON)

## Out of Scope (Phase 5+)

- Porcelain output format
- Color-coded output
- Interactive TUI
- Shell completions
